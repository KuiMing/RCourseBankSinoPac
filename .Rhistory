p
currenttime=proc.time()	## current time record
p <- 1/2*sum((1/4)^c(0:1000)) # calculate in one line
(spttime=proc.time()-currenttime)
p
currenttime=proc.time()	## current time record
p <- 0
for (i in 0:1000){
p <- p + 1/2*(1/4)^i
}
(spttime=proc.time()-currenttime)
p
# currenttime=proc.time()	## current time record
p <- 1/2
t <- c(0:1000)
p <- p*sum((1/4)^t)
currenttime=proc.time()	## current time record
p <- 1/2*sum((1/4)^c(0:1000)) # calculate in one line
(spttime=proc.time()-currenttime)
p
?proc.time
temp <- proc.time()	## current time record
p <- 1/2*sum((1/4)^c(0:1000)) # calculate in one line
spttime <- proc.time() - temp
p
temp <- proc.time()	## current time record
p <- 1/2*sum((1/4)^c(0:1000)) # calculate in one line
(spttime <- proc.time() - temp)
p
temp <- proc.time()	## current time record
p <- 0
for (i in 0:1000){
p <- p + 1/2*(1/4)^i
}
(spttime <- proc.time() - temp)
p
rm(p, p1, p2)
rm(list = ls())
?'<-'
?'='
?'<<-'
?help
??help
1 + 1
1:10
x <- c(1:10)
y <- c(2:5)
x/y
source('~/.active-rstudio-document', echo=TRUE)
1 + 1
1:10
x <- c(1:10)
y <- c(2:5)
x + y
y + x
x * y
q()
library(DSC2015R)
swirl()
slides
slide()
q()
install.packages("drat", repos="https://cran.rstudio.com")
drat:::addRepo("dmlc")
install.packages("mxnet")
library(mxnet)
?"mxnet"
q()
install.packages(gdata)
install.packages("gdata")
getwd()
library(httr)
?POST
url = "http://www.starbucks.com.tw/store/region.serx"
res = POST(url = url, body = list(cid=11))
head(res)
res$content
node = xmlParse(content(res, as="text"))
library(XML)
node = xmlParse(content(res, as="text"))
url = "http://www.starbucks.com.tw/store/region.serx"
res = POST(url = url, body = list(cid=11))
node = xmlParse(content(res, as="text"))
resText <- content(res,'text')
resText
url = "http://www.starbucks.com.tw/stores/storesearch/stores_storesearch.jspx"
res = POST(url = url)
resText <- content(res,'text')
head(resText)
url = "http://www.starbucks.com.tw/stores/storesearch/stores_storesearch.jspx"
res = POST(url = url, body = list(selCity = 11, selRegion = 106))
resText <- content(res,'text')
head(resText)
node = xmlParse(content(res, as="text"))
url = "http://www.starbucks.com.tw/stores/storesearch/stores_storesearch.jspx"
res = POST(url = url, body = list("selCity" = 14,
"selRegion" = "ALL",
"sbForm:btnByRegion" = "sbForm:btnByRegion",
"AJAXREQUEST" = "sbForm:j_id_jsp_201517923_2",
"sbForm:drive" = 1,
"sbForm_SUBMIT" = 1))
resText <- content(res,'text')
head(resText)
node = xmlParse(content(res, as = "text"))
View(xmlToDataFrame(node["//GeoPosition"]))
View(resText)
?node
install.packages("CSS")
res <- htmlParse(res)
head(res)
res = POST(url = url, body = list("selCity" = 14,
"selRegion" = "ALL",
"sbForm:btnByRegion" = "sbForm:btnByRegion",
"AJAXREQUEST" = "sbForm:j_id_jsp_201517923_2",
"sbForm:drive" = 1,
"sbForm_SUBMIT" = 1))
res <- htmlParse(res)
url = "http://www.starbucks.com.tw/stores/storesearch/stores_storesearch.jspx"
res = POST(url = url, body = list("selCity" = 14,
"selRegion" = "ALL",
"sbForm:btnByRegion" = "sbForm:btnByRegion",
"AJAXREQUEST" = "sbForm:j_id_jsp_201517923_2",
"sbForm:drive" = 1,
"sbForm_SUBMIT" = 1))
resText <- content(res,'text')
head(resText)
node = xmlParse(content(res, as = "text"))
node = xmlParse(content(resText, as = "text"))
node = xmlParse(content(res, as = "text"))
View(xmlToDataFrame(node["//GeoPosition"]))
node = xmlParse(content(res, as = "text"))
node = xmlParse(content(res))
?xmlValue
?xmlParse
url = "http://www.starbucks.com.tw/stores/storesearch/stores_storesearch.jspx"
res = POST(url = url, body = list("selCity" = 11,
"selRegion" = "ALL",
"sbForm:btnByRegion" = "sbForm:btnByRegion",
"AJAXREQUEST" = "sbForm:j_id_jsp_201517923_2",
"sbForm:drive" = 1,
"sbForm_SUBMIT" = 1))
resText <- content(res,'text')
res$url
res$status_code
res$headers
res$cookies
res$content
node = xmlParse(res$content)
node = xmlParse(res$content)
node
node = xmlParse(res$content)
doc <- htmlParse(res)
doc[]
doc["//searchstore_name"]
doc["//searchstore_name"]
install.packages("plotly")
library(plotly)
?ggplotly
example(ggplotly)
ggiris <- qplot(Petal.Width, Sepal.Length, data = iris, color = Species)
ggplotly(ggiris)
data(canada.cities, package = "maps")
viz <- ggplot(canada.cities, aes(long, lat)) +
borders(regions = "canada", name = "borders") +
coord_equal() +
geom_point(aes(text = name, size = pop), colour = "red",
alpha = 1/2, name = "cities")
ggplotly(viz)
install.packages("maps")
install.packages("maps")
data(canada.cities, package = "maps")
viz <- ggplot(canada.cities, aes(long, lat)) +
borders(regions = "canada", name = "borders") +
coord_equal() +
geom_point(aes(text = name, size = pop), colour = "red",
alpha = 1/2, name = "cities")
ggplotly(viz)
rm(list = ls())
library(plotly)
?ggplotly
example(ggplotly)
ggiris <- qplot(Petal.Width, Sepal.Length, data = iris, color = Species)
ggplotly(ggiris)
# install.packages("maps")
data(canada.cities, package = "maps")
viz <- ggplot(canada.cities, aes(long, lat)) +
borders(regions = "canada", name = "borders") +
coord_equal() +
geom_point(aes(text = name, size = pop), colour = "red",
alpha = 1/2, name = "cities")
ggplotly(viz)
q(*)
q()
q()
q()
setwd("~/Documents/BankSinoPac/")
install.packages("xlsx")
library(xlsx)
library(rJava)
library("rJava", lib.loc="/usr/local/lib/R/3.2/site-library")
detach("package:rJava", unload=TRUE)
install.packages("rJava")
install.packages("~/Downloads/rJava_0.9-8.tar.gz", repos = NULL, type = "source", lib="/usr/local/Cellar/r/3.2.3/R.framework/Versions/3.2/Resources/library")
library(rJava)
library(rJava)
library(xlsx)
try3 <- read.xlsx2("~/Downloads/10001信用卡發卡機構重要業務及財務資訊-揭露.xls")
try3 <- read.xlsx2("~/Downloads/10001信用卡發卡機構重要業務及財務資訊-揭露.xls")
try3 <- read.xlsx2("~/Downloads/10001信用卡發卡機構重要業務及財務資訊-揭露.xls", sheetIndex = 1)
head(try3)
try3$信用卡重要業務及財務資訊.資訊揭露.
library(stringr)
install.packages("XLConnect")
library(XLConnect)
setwd("~/Documents/BankSinoPac/")
try4 <- loadWorkbook("~/Downloads/10401信用卡重要資訊揭露.xlsx")
head(try4)
try5 <- data.table(try4)
library(data.table)
try5 <- data.table(try4)
try5$try4
try5
try5 <- as.data.table(try4)
try5 <- data.table(try4)
View(try5)
View(try4)
head(try4)
str(try4)
try4_2 <- readWorksheet(try4, sheet = 1, header = TRUE)
head(try4_2)
str(try4_2)
try4_3 <- as.data.table(try4_2)
try4_3$Col2
try4_3$Col3
library(rvest)
?rvest
??rvest
?data.table::fread
install.packages("readxl")
library(readxl)
try6 <- read_excel("~/Downloads/10001信用卡發卡機構重要業務及財務資訊-揭露.xls")
head(try6)
try6$`信用卡重要業務及財務資訊(資訊揭露)`
try6$``
head(try6$`信用卡重要業務及財務資訊(資訊揭露)`)
?read_excel
try6 <- read_excel("~/Downloads/10401信用卡重要資訊揭露.xlsx")
head(try6)
str(try6)
str(try6)
library("rvest")
url <- "http://en.wikipedia.org/wiki/List_of_U.S._states_and_territories_by_population"
population <- url %>%
html() %>%
html_nodes(xpath='//*[@id="mw-content-text"]/table[1]') %>%
html_table()
population <- population[[1]]
head(population)
grep("^R(Studio)?$", c("R","RStudio","Studio","R!", "abcR","RS","RStu","RStudioStudio"), value = TRUE)
## install packages
packages_w1 <- c("rvest","stringr","selectr","quantmod","devtools","rjson","jsonlite","rlist","magrittr","pipeR")
install.package(packages_w1)
library(magrittr)
library(rvest)
library(httr)
library(devtools)
sapply(packages_w1,library,character.only=TRUE)
## View Data
head(iris)
tail(iris)
# View(iris)
summary(iris)
## explor object
attributes(iris)
str(iris)
class(iris)
## data shape
dim(iris)
ncol(iris)
nrow(iris)
# install.packages("quantmod")
library(quantmod)
# quantmod::getSymbols
getSymbols("2330.TW")
## What's wrong? ##
View(2330.TW)
View(getSymbols("2330.TW"))
TW_2330 <- getSymbols("2330.TW")
# get("2330.TW")
head(TW_2330)
tail(TW_2330)
View(TW_2330)
summary(TW_2330)
dim(TW_2330)
ncol(TW_2330)
nrow(TW_2330)
a <- 1:4
assign("a[1]", 2)
a[1] == 2          # FALSE
get("a[1]") == 2   # TRUE
head(ls())
getwd()
# setwd("~/works/RCrawler/RCrawlerCrashCourse")
# quantmod::
# quantmod:::
source("install_packages.r")
packages_w2
RCourseDate <- c("2015-12-18","2016-01-04","2016-01-13","2016-01-29")
Today <- Sys.Date()
ifelse(Today %in% RCourseDate,"開薰學R語言","今日打東東")
NormalSampleData <- function(N,mu){rnorm(N)+ mu}
system.time(for(i in 1:1e5) NormalSampleData(100,0))
system.time(for(i in 1:1e5) do.call(NormalSampleData, list(100,0)))
## Syntax 1
httr::POST(URL, body= list(para1=paraVal1,para2=paraVal2))
library(httr)
library(rvest)
library(stringr)
## Connector
Target_URL = "http://tw.stock.yahoo.com/d/s/major_2451.html"
res <- GET(Target_URL)
doc_str <- content(res, type = "text", encoding = "big5")
## Parser
data_table <- doc_str %>% read_html(encoding = "utf8") %>% html_nodes(xpath = "//table[1]//table[2]") %>% html_table(header=TRUE)
# View(data_table[[1]])
View(data_table[[1]])
library(httr)
library(rvest)
## Connector
res <- POST("http://mops.twse.com.tw/mops/web/ajax_t51sb01",body = "encodeURIComponent=1&step=1&firstin=1&TYPEK=sii&code=")
doc_str <- content(res, "text", encoding = "utf8")
write(doc_str, file = "mops.html")
## Parser
data_table <- doc_str %>% read_html(encoding = "utf8") %>% html_nodes(xpath = "//table[2]") %>% html_table(header=TRUE)
# View(data_table)
library(rvest)
library(httr)
bankingUrl <- "http://www.banking.gov.tw/ch/home.jsp?id=192&parentpath=0,4&mcustomize=multimessage_view.jsp&dataserno=21207&aplistdn=ou=disclosure,ou=multisite,ou=chinese,ou=ap_root,o=fsc,c=tw&toolsflag=Y&dtable=Disclosure"
res <- GET(bankingUrl,set_cookies("cookiesession1=0F51E397POLJ4NQTC2CT7TGE8VBT033D; JSESSIONID=13A259B7048E0A96163333DA9D9BE428; fontsize=80%; _ga=GA1.3.807240144.1448956489; _gat=1"))
doc_str <- content(res, type = "text", encoding = "utf8")
# parser with URL
doc <- htmlParse(doc_str)
library(rvest)
html <- read_html(doc_str)
monthsUrl <- html_nodes(html,"table[summary='信用卡重要業務及財務資訊揭露'] a[href]")
# get value
html_text(monthsUrl)
html_attr(monthsUrl, name = "href")
# pipe to url
monthsUrlList <- content(res, type = "text", encoding = "utf8") %>% read_html %>% html_nodes("table[summary='信用卡重要業務及財務資訊揭露'] a") %>% html_attr("href")
monthsUrlList <- ifelse(substr(monthsUrlList,1,1)=='/',paste0("http://www.fsc.gov.tw",monthsUrlList),monthsUrlList)
# library(stringr)
dataDir <- "/home/gg/data/bankingCreditCard/"
fileName <- paste0(dataDir,fileName <- sub("&flag=doc$","",sub(".*file=/", "", monthsUrlList)))
# download.file(monthsUrlList, destfile = paste0("/home/gg/data/bankingCreditCard/",fileName <- sub("&flag=doc$","",sub(".*file=/", "", monthsUrlList[1:2]))), mode="wb")
system.time(
for (i in 1:length(fileName)){
print(monthsUrlList[i])
try(download.file(url = monthsUrlList[i], destfile = fileName[i], mode = "w"), silent = TRUE)
}
)
sum((fileName %>% file.info)$size)
data_table <- doc_str %>% read_html(encoding = "utf8") %>% html_nodes(xpath = "//table[1]//table[2]") %>% html_table(header=TRUE)
View(data_table[[1]])
res <- POST("http://mops.twse.com.tw/mops/web/ajax_t51sb01",body = "encodeURIComponent=1&step=1&firstin=1&TYPEK=sii&code=")
doc_str <- content(res, "text", encoding = "utf8")
data_table <- doc_str %>%
read_html() %>%
html_nodes(xpath = "//table[2]") %>%
html_table(header=FALSE)
head(data_table)
head(data_table[[1]])
head(try3)
try3dt[1,3]
try3dt <- as.data.table(try3)
try3dt[1,3]
try3dt[1:3]
try3dt[4:end]
?is.na
try3dt[~is.na(X.), ]
try3dt[is.na(X.), ]
try3dt[is.na(X..1), ]
try3dt[-is.na(X..1), ]
install.packages(c('rzmq','repr','IRkernel','IRdisplay'),
repos = c('http://irkernel.github.io/', getOption('repos')))
IRkernel::installspec()
library(httr)
library(jsonlite)
FM_TW_STORE <- data.frame()
addr_tw <- c("基隆市","台北市","新北市","桃園市","新竹市","新竹縣","苗栗縣","台中市","彰化縣","南投縣","雲林縣","嘉義市","嘉義縣","台南市","高雄市","屏東縣","宜蘭縣","花蓮縣","台東縣","澎湖縣","金門縣")
for(a in 1:length(addr_tw))
{
addr <- URLencode(addr_tw[a])
FM_URL = paste0("http://api.map.com.tw/net/familyShop.aspx?searchType=ShopList&type=&city=",addr,"&area=&road=&fun=showStoreList&key=6F30E8BF706D653965BDE302661D1241F8BE9EBC", collapse = "")
FM_store <- GET(FM_URL, config=set_cookies('ServerName'='www%2Efamily%2Ecom%2Etw;',
"ASPSESSIONIDSQDBRTSD"="PLBKNCAGIGAKILIPJALCPKK;",
"ASP.NET_SessionId"="nnhplttz2ofmvfypfbsuyo0f"),
add_headers("User-Agent" = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.80 Safari/537.36",
"Referer" = "http://www.family.com.tw/marketing/inquiry.aspx",
"Host" = "api.map.com.tw",
"Connection" = "keep-alive",
"Accept-Language" = "zh-TW,zh;q=0.8,en-US;q=0.6,en;q=0.4",
"Accept-Encoding" = "gzip, deflate, sdch",
"Accept" = "*/*"))
FM_store_list <- content(FM_store, type="text", encoding = "utf8")
jsonDataString = sub("[^\\]]*$","",sub("^[^\\[]*","",FM_store_list))
jsonData = fromJSON(jsonDataString)
jsonData$city = addr_tw[a]
FM_TW_STORE <- rbind(FM_TW_STORE, jsonData)
t <- runif(1, 1.1, 5.5)
Sys.sleep(t)
}
}
print(Sys.time()-strt)
head(FM_TW_STORE)
?read_xml
library(httr)
library(jsonlite)
FM_TW_STORE <- data.frame()
addr_tw <- c("基隆市","台北市","新北市","桃園市","新竹市","新竹縣","苗栗縣","台中市","彰化縣","南投縣","雲林縣","嘉義市","嘉義縣","台南市","高雄市","屏東縣","宜蘭縣","花蓮縣","台東縣","澎湖縣","金門縣")
for(a in 1:length(addr_tw))
{
addr <- addr_tw[a] # addr <- URLencode(addr_tw[a])
FM_URL = paste0("http://api.map.com.tw/net/familyShop.aspx?searchType=ShopList&type=&city=",addr,"&area=&road=&fun=showStoreList&key=6F30E8BF706D653965BDE302661D1241F8BE9EBC", collapse = "")
FM_store <- GET(FM_URL, config=set_cookies('ServerName'='www%2Efamily%2Ecom%2Etw;',
"ASPSESSIONIDSQDBRTSD"="PLBKNCAGIGAKILIPJALCPKK;",
"ASP.NET_SessionId"="nnhplttz2ofmvfypfbsuyo0f"),
add_headers("User-Agent" = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.80 Safari/537.36",
"Referer" = "http://www.family.com.tw/marketing/inquiry.aspx",
"Host" = "api.map.com.tw",
"Connection" = "keep-alive",
"Accept-Language" = "zh-TW,zh;q=0.8,en-US;q=0.6,en;q=0.4",
"Accept-Encoding" = "gzip, deflate, sdch",
"Accept" = "*/*"))
FM_store_list <- content(FM_store, type="text", encoding = "utf8")
jsonDataString = sub("[^\\]]*$","",sub("^[^\\[]*","",FM_store_list))
jsonData = fromJSON(jsonDataString)
jsonData$city = addr_tw[a]
FM_TW_STORE <- rbind(FM_TW_STORE, jsonData)
#t <- runif(1, 1.1, 5.5)
#Sys.sleep(t)
}
library(httr)
library(jsonlite)
FM_TW_STORE <- data.frame()
addr_tw <- c("基隆市")#,"台北市","新北市","桃園市","新竹市","新竹縣","苗栗縣","台中市","彰化縣","南投縣","雲林縣","嘉義市","嘉義縣","台南市","高雄市","屏東縣","宜蘭縣","花蓮縣","台東縣","澎湖縣","金門縣")
for(a in 1:length(addr_tw))
{
addr <- addr_tw[a]#URLencode(addr_tw[a])
FM_URL = paste0("http://api.map.com.tw/net/familyShop.aspx?searchType=ShopList&type=&city=",addr,"&area=&road=&fun=showStoreList&key=6F30E8BF706D653965BDE302661D1241F8BE9EBC", collapse = "")
FM_store <- GET(FM_URL, config = set_cookies('ServerName'='www%2Efamily%2Ecom%2Etw;',
"ASPSESSIONIDSQDBRTSD"="PLBKNCAGIGAKILIPJALCPKK;",
"ASP.NET_SessionId"="nnhplttz2ofmvfypfbsuyo0f")
add_headers("Referer" = "http://www.family.com.tw/marketing/inquiry.aspx"))
FM_store_list <- content(FM_store, type="text", encoding = "utf8")
jsonDataString = sub("[^\\]]*$","",sub("^[^\\[]*","",FM_store_list))
jsonData = fromJSON(jsonDataString)
jsonData$city = addr_tw[a]
FM_TW_STORE <- rbind(FM_TW_STORE, jsonData)
#t <- runif(1, 1.1, 5.5)
#Sys.sleep(t)
}
addr_tw <- c("基隆市")#,"台北市","新北市","桃園市","新竹市","新竹縣","苗栗縣","台中市","彰化縣","南投縣","雲林縣","嘉義市","嘉義縣","台南市","高雄市","屏東縣","宜蘭縣","花蓮縣","台東縣","澎湖縣","金門縣")
for(a in 1:length(addr_tw))
{
addr <- addr_tw[a]#URLencode(addr_tw[a])
FM_URL = paste0("http://api.map.com.tw/net/familyShop.aspx?searchType=ShopList&type=&city=",addr,"&area=&road=&fun=showStoreList&key=6F30E8BF706D653965BDE302661D1241F8BE9EBC", collapse = "")
FM_store <- GET(FM_URL, config = set_cookies('ServerName'='www%2Efamily%2Ecom%2Etw;',
"ASPSESSIONIDSQDBRTSD"="PLBKNCAGIGAKILIPJALCPKK;",
"ASP.NET_SessionId"="nnhplttz2ofmvfypfbsuyo0f")
add_headers("Referer" = "http://www.family.com.tw/marketing/inquiry.aspx"))
for(a in 1:length(addr_tw))
{
addr <- addr_tw[a]#URLencode(addr_tw[a])
FM_URL = paste0("http://api.map.com.tw/net/familyShop.aspx?searchType=ShopList&type=&city=",addr,"&area=&road=&fun=showStoreList&key=6F30E8BF706D653965BDE302661D1241F8BE9EBC", collapse = "")
FM_store <- GET(FM_URL, config = set_cookies('ServerName'='www%2Efamily%2Ecom%2Etw;',
"ASPSESSIONIDSQDBRTSD"="PLBKNCAGIGAKILIPJALCPKK;",
"ASP.NET_SessionId"="nnhplttz2ofmvfypfbsuyo0f"),
add_headers("Referer" = "http://www.family.com.tw/marketing/inquiry.aspx"))
FM_store_list <- content(FM_store, type="text", encoding = "utf8")
jsonDataString = sub("[^\\]]*$","",sub("^[^\\[]*","",FM_store_list))
jsonData = fromJSON(jsonDataString)
jsonData$city = addr_tw[a]
FM_TW_STORE <- rbind(FM_TW_STORE, jsonData)
#t <- runif(1, 1.1, 5.5)
#Sys.sleep(t)
}
FM_TW_STORE
addr_tw[a]
FM_URL
rm(list = ls())
library(httr)
library(jsonlite)
FM_TW_STORE <- data.frame()
addr_tw <- c("基隆市")#,"台北市","新北市","桃園市","新竹市","新竹縣","苗栗縣","台中市","彰化縣","南投縣","雲林縣","嘉義市","嘉義縣","台南市","高雄市","屏東縣","宜蘭縣","花蓮縣","台東縣","澎湖縣","金門縣")
for(a in 1:length(addr_tw))
{
addr <- addr_tw[a]#URLencode(addr_tw[a])
FM_URL = paste0("http://api.map.com.tw/net/familyShop.aspx?searchType=ShopList&type=&city=",addr,"&area=&road=&fun=showStoreList&key=6F30E8BF706D653965BDE302661D1241F8BE9EBC", collapse = "")
FM_store <- GET(FM_URL, config = set_cookies('ServerName'='www%2Efamily%2Ecom%2Etw;',
"ASPSESSIONIDSQDBRTSD"="PLBKNCAGIGAKILIPJALCPKK;",
"ASP.NET_SessionId"="nnhplttz2ofmvfypfbsuyo0f"),
add_headers("Referer" = "http://www.family.com.tw/marketing/inquiry.aspx"))
FM_store_list <- content(FM_store, type="text", encoding = "utf8")
jsonDataString = sub("[^\\]]*$","",sub("^[^\\[]*","",FM_store_list))
jsonData = fromJSON(jsonDataString)
jsonData$city = addr_tw[a]
FM_TW_STORE <- rbind(FM_TW_STORE, jsonData)
#t <- runif(1, 1.1, 5.5)
#Sys.sleep(t)
}
q()
